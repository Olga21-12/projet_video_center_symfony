{% extends 'base.html.twig' %}
{% block title %}Accueil - Video Center{% endblock %}
{% block body %}

<div class="text-center p-4">
    <h1 class="mb-4">{{ 'home.welcome'|trans }}</h1>

    {% if not app.user %}
    <p>{{ 'home.welcome_text'|trans }}</p>
        <div class="d-flex justify-content-center gap-3 mt-3 flex-wrap">
            <a href="{{ path('app_register') }}" class="btn btn-success">{{ 'navBar.inscription'|trans }}</a>
            <a href="{{ path('app_login') }}" class="btn btn-primary">{{ 'navBar.connexion'|trans }}</a>
        </div>
    {% endif %}
</div>

{# carousel #}
    <div id="randomCarousel" class="carousel slide mx-auto" style="width: 85%;" data-bs-ride="carousel">
        <div class="carousel-inner">
            {% for video in randomVideos %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                    <iframe width="100%" height="400"
                            src="{{ video.videoLink }}"
                            title="{{ video.title }}"
                            frameborder="0"
                            allowfullscreen>
                    </iframe>
                </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#randomCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#randomCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

<div class="d-flex justify-content-center gap-3 my-3 flex-wrap">

    {# filter #}
    <a href="{{ path('app_home') }}"
       class="{% if not currentCategory %}fw-bold text-primary{% endif %}">
        Toutes les vid√©os ({{ totalVideo }})
    </a>

    {% for cat in categories %}
        <a href="{{ path('app_home', { category: cat.name }) }}"
           class="{% if currentCategory == cat.name %}fw-bold text-primary{% endif %}">
            {{ cat.name }} ({{ cat.videoCount }})
        </a>
    {% endfor %}
</div>

{# search #}
    {% if app.user and app.user.isVerified %}
        <div class="container container-search mb-4 d-flex justify-content-center">
            {{ form_start(searchForm, {'attr': {'class': 'row'}}) }}
                <div class="col-md-10">
            {{ form_widget(searchForm.query) }}
                </div>
        <div class="col-md-2">
            <button type="submit" class="btn bg-transparent border border-dark rounded p-2">
                &#128269;
            </button>
        </div>
            {{ form_end(searchForm) }}
        </div>
    {% endif %}

<h4 class="text-center p-4 mt-4">{{ 'home.videos'|trans }} ({{ totalVideo }})</h4>

<div class="row">
    {% for video in videos %}

    {% if app.user and isVerified or (not video.premiumVideo) %}

        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="text-center p-2">
                    <iframe width="300" height="200"
                            src="{{ video.videoLink }}"
                            title="{{ video.title }}"
                            frameborder="0"
                            allowfullscreen>
                    </iframe>
                </div>

        <div class="card-body d-flex flex-column">
            <h5 class="card-title text-truncate mb-1">
                <a href="{{ path('app_video_show', {id: video.id}) }}" class="text-decoration-none">
                {{ video.title }}</a>
            </h5>
        
            <p class="card-text text-truncate">{{ video.description }}</p>

            {% if video.premiumVideo %}
                <span class="text-warning fs-5">‚≠ê</span>
            {% endif %}

            <div class="mt-auto">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <a href="{{ path('app_video_show', {id: video.id}) }}" class="btn btn-primary btn-sm">
                                    {{ 'home.view'|trans }}
                                </a>

                                {% if app.user and app.user.isVerified and app.user.email == video.user.email %}
                                    <div class="d-flex gap-2">
                                        <a class="btn btn-warning btn-sm" href="{{ path('app_video_edit', {id: video.id}) }}">‚úèÔ∏è</a>
                                        <a class="btn btn-danger btn-sm" href="{{ path('app_video_delete', {id: video.id}) }}" onclick="return confirm('√ätes-vous s√ªr ?')">üóë</a>
                                    </div>
                                {% endif %}
                            </div>

    


            <p class="mt-2 text-white small">
                {{ video.createdAt|ago }} ‚Ä¢
                {{ video.user.firstname }}
                <img src="{{ asset(video.user.imageName ? 'uploads/users/' ~ video.user.imageName : 'image/default-avatar.png') }}"
                     alt="{{ video.user.firstname }}"
                     class="rounded-circle me-1"
                     style="width:20px; height:20px; object-fit:cover;">

            </p>
        </div>
                </div>
            </div>
            </div>
        {% endif %}
    {% else %}
        <p class="text-center text-muted mt-4">{{ 'profile.no_videos'|trans }}</p>
    {% endfor %}
</div>

<div class="d-flex justify-content-center mt-4">
    {{ knp_pagination_render(videos) }}
</div>

{% endblock %}
